<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Login</title>
</head>
<body>

<h2>Login with Google</h2>
<button id="loginBtn">Login with Google</button>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { 
    getAuth, 
    GoogleAuthProvider, 
    signInWithPopup, 
    onAuthStateChanged 
  } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
  import { 
    getFirestore, 
    doc, 
    setDoc, 
    getDoc 
  } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  // ðŸ”´ à¦à¦–à¦¾à¦¨à§‡ à¦¤à§‹à¦®à¦¾à¦° à¦†à¦¸à¦² Firebase config à¦¬à¦¸à¦¾à¦¬à§‡
  const firebaseConfig = {
    apiKey: "AIzaSyDjEgk5EHgQD5HQJxEvHOzFwVyr9ZLEZBY",
    authDomain: "verifyprojectss.firebaseapp.com",
    projectId: "verifyprojectss",
    appId: "1:979191477358:web:2f5176ea9174579118a27f"
  };

  // Init
  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const provider = new GoogleAuthProvider();
  const db = getFirestore(app);

  // Login
  document.getElementById("loginBtn").onclick = async () => {
    try {
      const result = await signInWithPopup(auth, provider);
      const user = result.user;

      const ref = doc(db, "users", user.uid);
      const snap = await getDoc(ref);

      if (!snap.exists()) {
        await setDoc(ref, {
          name: user.displayName,
          email: user.email,
          balance: 0
        });
      }

      window.location.href = "dashboard.html";
    } catch (e) {
      alert(e.message);
    }
  };

  // Auto redirect
  onAuthStateChanged(auth, (user) => {
    if (user) window.location.href = "dashboard.html";
  });
</script>

</body>
</html>
