<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Login</title>
<style>
body { font-family: Arial; padding: 20px; max-width: 400px; margin: auto; text-align: center; }
button { padding: 10px 20px; margin: 10px 0; cursor: pointer; background-color: #23487f; color: white; border: none; }
</style>
</head>
<body>

<h2>Login with Google</h2>
<button id="loginBtn">Login with Google</button>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

// ðŸ”¹ Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyDjEgk5EHgQD5HQJxEvHOzFwVyr9ZLEZBY",
  authDomain: "verifyprojectss.firebaseapp.com",
  projectId: "verifyprojectss",
  appId: "1:979191477358:web:2f5176ea9174579118a27f"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const provider = new GoogleAuthProvider();
const db = getFirestore(app);

// ðŸ”¹ Login button
document.getElementById("loginBtn").onclick = async () => {
  try {
    const result = await signInWithPopup(auth, provider);
    const user = result.user;

    const ref = doc(db, "users", user.uid);
    const snap = await getDoc(ref);

    // à¦¯à¦¦à¦¿ à¦¨à¦¤à§à¦¨ à¦‡à¦‰à¦œà¦¾à¦° à¦¹à§Ÿ, Firestore à¦ create à¦•à¦°à¦¬à§‡
    if (!snap.exists()) {
      await setDoc(ref, {
        name: user.displayName,
        email: user.email,
        balance: 100 // default balance
      });
    }

    window.location.href = "dashboard.html";
  } catch (e) {
    alert(e.message);
  }
};

// ðŸ”¹ Auto redirect à¦¯à¦¦à¦¿ à¦†à¦—à§‡ à¦¥à§‡à¦•à§‡ login à¦¥à¦¾à¦•à§‡
onAuthStateChanged(auth, (user) => {
  if (user) window.location.href = "dashboard.html";
});
</script>

</body>
</html>
